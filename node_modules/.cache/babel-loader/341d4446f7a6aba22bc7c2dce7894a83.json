{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { CardElement } from '@stripe/react-stripe-js';\nimport { db, FirebaseTimestamp } from \"../../firebase/index\";\nimport { push } from \"connected-react-router\";\nimport { useDispatch } from 'react-redux';\nconst headers = new Headers();\nheaders.set('Content-type', 'application/json');\nconst BASE_URL = \"https://ec-app-8ba0b.web.app/\";\n\nconst createCustomer = async (email, paymentMehotdId, uid) => {\n  _s();\n\n  const dispatch = useDispatch();\n  const response = await fetch(BASE_URL + 'v1/customer', {\n    method: 'POST',\n    headers: headers,\n    body: JSON.stringify({\n      email: email,\n      paymentMehotd: paymentMehotdId,\n      uid: uid\n    })\n  }); // アロー関数を実行してJSON形式で値を受け取っている\n\n  const customerResponse = await response.json(); // 返り値として作成したレスポンスのbodyを取得している\n\n  return JSON.parse(customerResponse.body);\n};\n\n_s(createCustomer, \"rgTLoBID190wEKCp9+G8W6F7A5M=\", false, function () {\n  return [useDispatch];\n});\n\nexport const registerCard = (stripe, elements) => {\n  return async (dispatch, getState) => {\n    const user = getState().users;\n    const email = user.email;\n    const uid = user.id;\n    const username = user.name;\n\n    if (!stripe || !elements) {\n      // Stripe.js has not loaded yet. Make sure to disable\n      // form submission until Stripe.js has loaded.\n      return;\n    } // Get a reference to a mounted CardElement. Elements knows how\n    // to find your CardElement because there can only ever be one of\n    // each type of element.\n\n\n    const cardElement = elements.getElement(CardElement); // Use your card Element with other Stripe.js APIs\n\n    const {\n      error,\n      paymentMethod\n    } = await stripe.createPaymentMethod({\n      type: 'card',\n      card: cardElement\n    });\n\n    if (error) {\n      console.log('error');\n      return;\n    }\n\n    const paymentMehotdId = paymentMethod.id;\n    const customerData = await createCustomer(email, paymentMehotdId, uid); // 処理がうまくいっているのかの確認を行う\n\n    if (customerData.id === \"\") {\n      alert('カード情報の登録に失敗しました');\n      return;\n    } else {\n      const updateUserState = {\n        customer_id: customerData.id,\n        payment_method_id: paymentMehotdId\n      };\n      db.collection('users').doc(uid).update(updateUserState).then(() => {\n        dispatch(updateUserStateAction(updateUserState));\n      });\n    }\n  };\n};","map":{"version":3,"sources":["/Users/itoukazunari/Desktop/ec-app/src/reducks/payments/operations.js"],"names":["CardElement","db","FirebaseTimestamp","push","useDispatch","headers","Headers","set","BASE_URL","createCustomer","email","paymentMehotdId","uid","dispatch","response","fetch","method","body","JSON","stringify","paymentMehotd","customerResponse","json","parse","registerCard","stripe","elements","getState","user","users","id","username","name","cardElement","getElement","error","paymentMethod","createPaymentMethod","type","card","console","log","customerData","alert","updateUserState","customer_id","payment_method_id","collection","doc","update","then","updateUserStateAction"],"mappings":";;AAAA,SAAQA,WAAR,QAA0B,yBAA1B;AACA,SAASC,EAAT,EAAaC,iBAAb,QAAsC,sBAAtC;AACA,SAASC,IAAT,QAAqB,wBAArB;AACA,SAASC,WAAT,QAA4B,aAA5B;AAGA,MAAMC,OAAO,GAAG,IAAIC,OAAJ,EAAhB;AACAD,OAAO,CAACE,GAAR,CAAY,cAAZ,EAA4B,kBAA5B;AACA,MAAMC,QAAQ,GAAG,+BAAjB;;AAEA,MAAMC,cAAc,GAAG,OAAMC,KAAN,EAAaC,eAAb,EAA8BC,GAA9B,KAAsC;AAAA;;AACzD,QAAMC,QAAQ,GAAGT,WAAW,EAA5B;AAEA,QAAMU,QAAQ,GAAG,MAAMC,KAAK,CAACP,QAAQ,GAAG,aAAZ,EAA2B;AACrDQ,IAAAA,MAAM,EAAE,MAD6C;AAErDX,IAAAA,OAAO,EAAEA,OAF4C;AAGrDY,IAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBT,MAAAA,KAAK,EAAEA,KADY;AAEnBU,MAAAA,aAAa,EAAET,eAFI;AAGnBC,MAAAA,GAAG,EAAEA;AAHc,KAAf;AAH+C,GAA3B,CAA5B,CAHyD,CAazD;;AACA,QAAMS,gBAAgB,GAAG,MAAMP,QAAQ,CAACQ,IAAT,EAA/B,CAdyD,CAgBzD;;AACA,SAAOJ,IAAI,CAACK,KAAL,CAAWF,gBAAgB,CAACJ,IAA5B,CAAP;AACH,CAlBD;;GAAMR,c;UACeL,W;;;AAmBrB,OAAO,MAAMoB,YAAY,GAAG,CAACC,MAAD,EAASC,QAAT,KAAsB;AAChD,SAAO,OAAOb,QAAP,EAAiBc,QAAjB,KAA6B;AAClC,UAAMC,IAAI,GAAGD,QAAQ,GAAGE,KAAxB;AACA,UAAMnB,KAAK,GAAEkB,IAAI,CAAClB,KAAlB;AACA,UAAME,GAAG,GAAGgB,IAAI,CAACE,EAAjB;AACA,UAAMC,QAAQ,GAAGH,IAAI,CAACI,IAAtB;;AAEA,QAAI,CAACP,MAAD,IAAW,CAACC,QAAhB,EAA0B;AACxB;AACA;AACA;AACD,KAViC,CAYlC;AACA;AACA;;;AACA,UAAMO,WAAW,GAAGP,QAAQ,CAACQ,UAAT,CAAoBlC,WAApB,CAApB,CAfkC,CAiBlC;;AACA,UAAM;AAACmC,MAAAA,KAAD;AAAQC,MAAAA;AAAR,QAAyB,MAAMX,MAAM,CAACY,mBAAP,CAA2B;AAC9DC,MAAAA,IAAI,EAAE,MADwD;AAE9DC,MAAAA,IAAI,EAAEN;AAFwD,KAA3B,CAArC;;AAKA,QAAIE,KAAJ,EAAW;AACTK,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACA;AACD;;AAED,UAAM9B,eAAe,GAAGyB,aAAa,CAACN,EAAtC;AACA,UAAMY,YAAY,GAAG,MAAMjC,cAAc,CAACC,KAAD,EAAQC,eAAR,EAAyBC,GAAzB,CAAzC,CA7BkC,CA+BlC;;AACA,QAAG8B,YAAY,CAACZ,EAAb,KAAoB,EAAvB,EAA0B;AACxBa,MAAAA,KAAK,CAAC,iBAAD,CAAL;AACA;AACD,KAHD,MAGK;AACH,YAAMC,eAAe,GAAG;AACtBC,QAAAA,WAAW,EAAEH,YAAY,CAACZ,EADJ;AAEtBgB,QAAAA,iBAAiB,EAAEnC;AAFG,OAAxB;AAKAV,MAAAA,EAAE,CAAC8C,UAAH,CAAc,OAAd,EAAuBC,GAAvB,CAA2BpC,GAA3B,EACCqC,MADD,CACQL,eADR,EAECM,IAFD,CAEM,MAAI;AACRrC,QAAAA,QAAQ,CAACsC,qBAAqB,CAACP,eAAD,CAAtB,CAAR;AACD,OAJD;AAKD;AAEF,GAhDD;AAiDD,CAlDM","sourcesContent":["import {CardElement} from '@stripe/react-stripe-js';\nimport { db, FirebaseTimestamp } from \"../../firebase/index\";\nimport { push } from \"connected-react-router\";\nimport { useDispatch } from 'react-redux';\n\n\nconst headers = new Headers();\nheaders.set('Content-type', 'application/json');\nconst BASE_URL = \"https://ec-app-8ba0b.web.app/\"\n\nconst createCustomer = async(email, paymentMehotdId, uid) => {\n    const dispatch = useDispatch()\n\n    const response = await fetch(BASE_URL + 'v1/customer', {\n      method: 'POST',\n      headers: headers,\n      body: JSON.stringify({\n        email: email,\n        paymentMehotd: paymentMehotdId,\n        uid: uid\n      })\n    })\n\n    // アロー関数を実行してJSON形式で値を受け取っている\n    const customerResponse = await response.json();\n\n    // 返り値として作成したレスポンスのbodyを取得している\n    return JSON.parse(customerResponse.body);\n}\n\nexport const registerCard = (stripe, elements) => {\n  return async (dispatch, getState)=> {\n    const user = getState().users;\n    const email= user.email\n    const uid = user.id\n    const username = user.name\n\n    if (!stripe || !elements) {\n      // Stripe.js has not loaded yet. Make sure to disable\n      // form submission until Stripe.js has loaded.\n      return;\n    }\n\n    // Get a reference to a mounted CardElement. Elements knows how\n    // to find your CardElement because there can only ever be one of\n    // each type of element.\n    const cardElement = elements.getElement(CardElement);\n\n    // Use your card Element with other Stripe.js APIs\n    const {error, paymentMethod} = await stripe.createPaymentMethod({\n      type: 'card',\n      card: cardElement,\n    });\n\n    if (error) {\n      console.log('error')\n      return\n    } \n\n    const paymentMehotdId = paymentMethod.id;\n    const customerData = await createCustomer(email, paymentMehotdId, uid)\n\n    // 処理がうまくいっているのかの確認を行う\n    if(customerData.id === \"\"){\n      alert('カード情報の登録に失敗しました')\n      return;\n    }else{\n      const updateUserState = {\n        customer_id: customerData.id,\n        payment_method_id: paymentMehotdId\n      }\n\n      db.collection('users').doc(uid)\n      .update(updateUserState)\n      .then(()=>{\n        dispatch(updateUserStateAction(updateUserState))\n      })\n    }\n    \n  }\n}"]},"metadata":{},"sourceType":"module"}